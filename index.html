<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diagnóstico Wompi El Salvador</title>
    <script type="text/javascript" src="https://checkout.wompi.sv/widget.js" 
            onload="console.log('Wompi cargado OK')" 
            onerror="alert('ERROR: No se pudo cargar la librería de Wompi. Revisa tu internet o bloqueador de anuncios.')">
    </script>
</head>
<body style="text-align: center; padding-top: 50px; font-family: Arial;">

    <h2>Prueba Directa Wompi SV</h2>
    <p>Si la librería cargó bien, al dar clic abajo DEBE abrirse la ventana.</p>
    
    <button id="btnPagar" onclick="ejecutarPago()" style="padding: 20px; font-size: 20px; background: #FF3B30; color: white; border: none; cursor: pointer;">
        PROBAR PAGO DE $25.00
    </button>

    <div id="status" style="margin-top: 20px; color: blue;"></div>

    <script>
    function ejecutarPago() {
        const statusDiv = document.getElementById('status');
        statusDiv.innerText = "Intentando abrir Wompi...";

        // Verificamos si la función WidgetCheckout existe en la memoria
        if (typeof WidgetCheckout === 'undefined') {
            alert("❌ ERROR: La función 'WidgetCheckout' no existe. El script de Wompi no se descargó correctamente.");
            statusDiv.innerText = "Error: Librería no encontrada.";
            return;
        }

        try {
            var checkout = new WidgetCheckout({
                currency: 'USD',
                amountInCents: 2500, // $25.00 en centavos
                country: 'SV',
                publicKey: 'pub_sv_ed7d20c2-ed4f-4f8e-95c5-ea686218079c', // Tu llave de SV
                reference: 'TEST_SV_' + Math.floor(Math.random() * 1000000)
            });

            checkout.open(function(result) {
                alert("Resultado: " + result.transaction.status);
            });
            
            statusDiv.innerText = "Ventana de pago enviada al navegador.";
        } catch (err) {
            alert("Error al intentar abrir el widget: " + err.message);
            statusDiv.innerText = "Error de ejecución.";
        }
    }
    </script>
</body>
</html>
